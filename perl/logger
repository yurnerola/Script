#!/usr/bin/perl

#Copyleft (C) Yurnerola

use LWP;
use strict;
use warnings;
use Getopt::Std;

use vars qw($opt_h $opt_i);

logger("logger @ARGV\n");

getopts('hi:') or die usage();

die usage() if $opt_h;
die usage() if !$opt_i;

print "---Content Generated By Logger---\n";

my $browser=LWP::UserAgent->new();
my $response=$browser->get("http://123.103.108.94:18010/fcgi_bin/get_hall_info.fcgi?id=$opt_i");
#print $response->content;
if ($response->content  =~ /hall_property=(\d+)\n/)
{
	#print "Room is locked\n" if ($1&0x02);
}

my $gas_ip=pinfo($response->content,"gas_ip");
my $gas_id=pinfo($response->content,"gas_id");

print "Hallid:$opt_i --- IP:$gas_ip\n\n";

print "-----Shell-----\n";
my $shell=<<EOF;
#!/bin/bash
cd /data0/ChatServer$gas_id/UCChatHall_log;
for i in `ls -t|grep $opt_i`;do echo \$i;cat \$i|grep use_prop|grep 100000172;done
EOF
print $shell;

open my $fshell,">","logger.sh";
print $fshell $shell;
close $fshell or die "$fshell:$!";

sub usage {
	return<<'_EOC_';
Usage:
	logger [options]

Options:
	-h              Print this usage.
	-i <hallid>
Example:
	logger -i 447283
_EOC_
}

sub pinfo
{
	if($_[0] =~ /$_[1]=(.*)\n/)
	{
		return $1;
	}
}

sub logger
{
	my $logmsg=shift;
	open my $log,">>","logger.log";
	print $log $logmsg;
	close $log or die "$log:$!";
}
